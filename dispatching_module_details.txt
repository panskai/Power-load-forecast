**模块定位**
GVdispatching/ 模块把预测阶段给出的未来负荷曲线转成可执行的机组+储能调度计划，并在不同策略间做成效对比与成本诊断。它涵盖预测模型加载、滚动优化调度、Pyomo 求解、实验编排以及成本分析的完整闭环。

- **预测器加载 – ModelPredictor**：根据权重路径判断是降级 LSTM、标准 LSTM 还是 LSTM‑Transformer，并恢复相应网络结构与归一化配置；同时兼容只保存参数或完整 checkpoint 的两种格式 dispatching/rolling_optimization.py:17-94。为了适配历史模型，_adapt_state_dict 会在加载时自动增删全连接层权重 dispatching/rolling_optimization.py:105-133，预测入口 predict/predict_batch 负责把输入序列搬到 GPU/CPU 并拿到标量预测 dispatching/rolling_optimization.py:209-250。  
- **滚动调度器 – RollingOptimizer**：构造时加载测试集 CSV 并建立 PyTorch 数据集、记录基本统计 dispatching/rolling_optimization.py:252-296。rolling_optimize 则在给定起点和步数下循环执行“预测→补偿→调度→指标采集”，把预测值、真实值、误差、调度成本与各类指标写入结果字典 dispatching/rolling_optimization.py:303-370。默认的 _generate_forecast 会利用 scaler 把最近 96 点的特征送入预测器，逐步扩展成滚动预测序列，并把预测结果反归一化后写回下一时刻作为自回归输入 dispatching/rolling_optimization.py:400-455。  
- **调度执行**：每步预测都会调用 _execute_dispatch，该函数会构建/更新 Pyomo 模型并交给调度器求解（详见下节）；执行结果连同成本、功率轨迹、SOC 等一并存入 results['dispatches']，后续 calculate_metrics 用来提取如成本、碳排、调整次数等指标 dispatching/rolling_optimization.py:357-365。  
- **强化策略 – EnhancedRollingOptimizer**：在基类的基础上，额外提供单步预测、传统经验法和误差反馈等策略来增强稳定性：例如 _generate_single_step_forecast 会在窗口内逐点构造输入、必要时补齐序列、叠加近期实际负荷趋势并设置安全边界，若预测报错就退回上一刻或默认值 dispatching/rolling_optimization.py:679-725；传统预测 _generate_traditional_forecast 则基于近几天负荷均值和线性趋势做快速估计 dispatching/rolling_optimization.py:728-744。  
- **调度求解 – OptimalDispatcher**：Pyomo 模型内部把时间、机组、储能都建成索引集合，并声明机组出力、储能功率与 SOC 等决策变量 dispatching/optimal_dispatch.py:27-47。_add_constraints 依次约束供需平衡、机组出力上下限、爬坡速率以及储能 SOC 范围 dispatching/optimal_dispatch.py:55-166；目标函数由机组线性成本、储能成本和可选碳排罚金组成 dispatching/optimal_dispatch.py:176-201。solve 按需注入补偿量，选择求解器（默认 GLPK，但可配置）并检查最优性，再把机组/储能时序结果、SOC 轨迹与成本打包返回 _extract_solution dispatching/optimal_dispatch.py:219-279。随后 calculate_metrics 会统计平均成本、碳排、调整次数以及预测误差等评价指标 dispatching/optimal_dispatch.py:296-332。  
- **实验编排 – ExperimentComparator**：该类负责把基线与提出方法的整体流程跑通。初始化时根据区域生成一套系统配置 dispatching/comparative_experiments.py:17-26。run_baseline_experiment 自动识别模型类型、构建 ModelPredictor 和 EnhancedRollingOptimizer，使用传统调度参数执行滚动优化并缓存结果、标记策略属性 dispatching/comparative_experiments.py:28-89。run_proposed_experiment 在此基础上调整可再生机组成本区间、放宽 SOC/功率约束等，再以给定反馈系数运行强化策略 dispatching/comparative_experiments.py:133-176。compare_experiments 把 baseline/proposed 的总体指标整理成表，计算改进幅度，必要时调用成本分析模块生成更详尽的诊断 dispatching/comparative_experiments.py:308-344。create_visualizations 则输出误差箱线图、成本箱线图、MAPE/成本柱状图及时间序列对比等图像 dispatching/comparative_experiments.py:416-475。  
- **成本诊断 – DispatchCostAnalyzer**：从调度结果提取机组/储能轨迹并细分成本构成，比较基线与提出方法的差异 dispatching/cost_analysis.py:11-49。它还会统计机组利用率、发电结构、储能充放电效率和调整频率等运行特征 dispatching/cost_analysis.py:19-25，最终在 print_detailed_analysis 中生成包含成本拆分、碳排、调整频率、效率改善等条目的文字报告 dispatching/cost_analysis.py:381-418。analyze_experiment_results 将上述分析封装返回，以便在对比实验中串联调用 dispatching/cost_analysis.py:531-537。  
- **实验资产化**：每轮滚动实验都会把基线与提出方法的原始结果、指标对比和图表存到 dispatching/results/comparison_* 目录，便于后续复盘和对外展示；其中 baseline/proposed JSON 分别记录逐时预测、成本、SOC 与约束信息，而 comparison JSON 汇总指标与改进比例，可直接用于绘图或写报告 dispatching/comparative_experiments.py:69-89, dispatching/comparative_experiments.py:133-176.

综上，dispatching/ 模块以 ModelPredictor→RollingOptimizer→OptimalDispatcher 的链路完成“预测-优化”闭环，再通过 ExperimentComparator 与 DispatchCostAnalyzer 做跨策略对比和诊断，从而评价不同负荷预测模型对低碳调度的价值。
